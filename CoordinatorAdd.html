<!DOCTYPE HTML>
<html>
    <head>
        <title class="headtitle">Desk Attendant Portal</title>
        <link rel="stylesheet" href="PackageSysStyle.css">
        <script src="https://unpkg.com/vue/dist/vue.js"></script>
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        <script>
            //%700^TALBOT, RICHARD J ?;6009951001783705=600000000?+E?

            var cardrgx = /(?:%E\?;E\?|\%(\d+)\^(\w+), (\w+) (\w)\s*\?;(\d+)=(\d+)\?)\+E\?/;
            function readCard(cinfo) {
                info = cardrgx.exec(cinfo);
                if (info != null) {
                    if (info[1] != null) {
                        $("#600_number").val(info[5]);
                        $("#first_name").val(info[3]);
                        $("#last_name").val(info[2]);
                    } else {
                        $("#600_number").val("");
                        $("#first_name").val("");
                        $("#last_name").val("");
                        alert("Error reading card");
                    }
                }
            }
<<<<<<< HEAD

=======

            var dfetch = true;
>>>>>>> 5b56da4f756731ff963a58ab1ed163240e45a2f5
            function login(cinfo) {
                info = cardrgx.exec(cinfo);
                if (info != null) {
                    if (info[1] != null) {
                        $.ajax("functions.php?a=login", {
                            'method': 'POST',
                            'data': {'first' : info[3], 'last' : info[2], 'n600' : info[5]},
                            'dataType': "json",
                            'success' : function(json) {
                                if (json.result) {
                                    if (dfetch) {
                                        dfetch = false;
                                        $.ajax("functions.php?a=getd", {
                                            'method': 'GET',
                                            'dataType': "json",
                                            'success' : function(json) {
                                                dvm.dorms = json.result;
                                            }
                                        });
                                    }
                                    $("#overlay").hide();
                                }
                            }
                        });
                    } else {
                        alert("Error reading card");
                    }
                }
            }
<<<<<<< HEAD

            var curcard = "%700^TALBOT, RICHARD J ?;6009951001783705=600000000?+E?";
=======

            var curcard = "";
>>>>>>> 5b56da4f756731ff963a58ab1ed163240e45a2f5
            function silentLogin(event) {
                curcard += String.fromCharCode(event.charCode);
                if (event.keyCode == 13) {
                    login(curcard);
                    curcard = "";
                }
            }
        </script>
    </head>

    <body class="indexBody">

        <div id="overlay" onkeypress="silentLogin(event)" tabindex="1" style="background: rgba(0, 0, 0, 0.67); position: absolute; top: 0px; left: 0px; width: 100%; height: 100%;">
            <div style="background: #FFFFFF; opacity: .75; position: absolute; top: 45%; left: 25%; width: 500px; height: 25px;">
                Swipe Mavcard to log back in to system
            </div>
        </div>

        <header>
            <img class = "CMULogo" alt="Colorado Mesa Unversity" src="cmu_white.png">
        </header>
        <nav>
            <ul>
                <li> <a href="CoordinatorAdd.html"  style="background-color: rgb(237,247,250); color:maroon;">Add Student</a></li>
                <li> <a href="CoordinatorRemove.html">Remove Student</a></li>
                <li> <a href="CoordinatorPackage.html">View Packages</a></li>
            </ul>
        </nav>
        Welcome to the Hall Coordinator Form. Please type a students first and last name to add them to the residence hall roster.<br>
        <em><small>Note: This will add a student to the residence hall database.</small></em>

        <div class="FormAdd">
            <br>
            <table>
                <tr>
                    <th>Swipe Mavcard:</th>
                    <td><input type="password" onkeypress="if (event.keyCode == 13) {readCard(this.value); this.value='';}"/></td>
                </tr>
            </table>
            <form>
                <table>
                    <tr>
                        <th>600 #:</th>
                        <td><input type="text" id="600_number" name="600_number" disabled/></td>
                    </tr>
                    <tr>
                        <th>Name:</th>
                        <td><input type="text" id="first_name" name="first_name" disabled/></td>
                        <td><input type="text" id="last_name" name="last_name" disabled/></td>
                    </tr>
                    <tr>
                        <th></th>
                    </tr>
                    <tr>
                        <th>Email:</th>
                        <td><input type="text" id="email" name="email" /></td>
                    </tr>
                    <tr>
			<th>Residence Hall:</th>
                        <td>
                            <select id="dorms" name="dorms">
                                <option v-for="dorm in dorms" :value="dorm.Unique_ID">{{dorm.Dorm_Name}}</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th><input type="submit" value="Submit" /></th>
                        <td><input type="button" value="Clear" onclick="clearFields();"/></td>
                    </tr>
                </table>
            </form>
        </div>

        <footer>
            &copy; Colorado Mesa University
        </footer>

        <script type="text/javascript">
            var dvm = new Vue({
                el: '#dorms',
                data: {
                    dorms: []
                }
            });
            $().ready(function() {$("#overlay").focus();});

            function clearFields() {
                $("#600_number").val("");
                $("#first_name").val("");
                $("#last_name").val("");
                $("#email").val("");
            }
            clearFields();
        </script>
    </body>
</html>
